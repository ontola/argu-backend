<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: components/FollowTheLaw.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: components/FollowTheLaw.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Follow the law module.
 * @module FollowTheLaw
 * @author Fletcher91 &lt;thom@argu.co>
 */

import React from 'react';
import {
    Record,
    List
} from 'immutable';
import RPhase from '../records/RPhase';
import RUpdate from '../records/RUpdate';
import RProfile from '../records/RProfile';
import RTimeline from '../records/RTimeline';
import { Update, UpdateContainerWrapper } from './Update';


import { bindActionCreators } from 'redux'
import { Provider, connect } from 'react-redux';
import store from '../stores/store';
import * as TimeLineActions from '../actions/timeline'

function mapStateToProps(state) {
    return {
        timelines: state.timelines,
        updates: state.updates,
        phases: state.phases,
        points: state.points
    }
}

function mapDispatchToProps(dispatch) {
    return {
        actions: bindActionCreators(TimeLineActions, dispatch)
    };
}

/**
 * Store wrapper around the TimeLineComponentContainer until we have a router.
 * @class TimeLineComponentContainerWrapper
 * @author Fletcher91 &lt;thom@argu.co>
 */
export const TimeLineComponentContainerWrapper = React.createClass({
    render: function render() {

        return (&lt;Provider store={store}>
            &lt;TimeLineComponentContainer timeLineId={this.props.timeLineId} />
        &lt;/Provider>);
    }
});
window.TimeLineComponentContainerWrapper = TimeLineComponentContainerWrapper;

/**
 * Store wrapper container
 * @class TimeLineComponentContainer
 * @author Fletcher91 &lt;thom@argu.co>
 */
let TimeLineComponentContainer = React.createClass({
    render: function render() {
        const { timeLineId, timelines, phases, updates, points, actions } = this.props;

        const timeLine = timelines.getIn(['collection', timeLineId.toString()]);

        return (&lt;div>
            &lt;TimeLineComponent timeLine={timeLine}
                               phases={phases}
                               points={points}
                               updates={updates}
                               actions={actions} />
        &lt;/div>);
    }
});
TimeLineComponentContainer = connect(mapStateToProps, mapDispatchToProps)(TimeLineComponentContainer);
window.TimeLineComponentContainer = TimeLineComponentContainer;

/**
 * Main TimeLine class.
 * @class TimeLineComponent
 * @author Fletcher91 &lt;thom@argu.co>
 */
export const TimeLineComponent = React.createClass({
    propTypes: {
        phases: React.PropTypes.instanceOf(List),
        points: React.PropTypes.instanceOf(List),
        timeLine: React.PropTypes.instanceOf(RTimeline),
        updates: React.PropTypes.instanceOf(List)
    },

    style: {
        display: 'flex',
        flexDirection: 'column'
    },

    activePoint: function () {
        const { timeLine, points } = this.props;
        const { activePointId } = timeLine;

        if (typeof activePointId === 'undefined') {
            return undefined;
        }

        return points.find((elem) => {
                return elem.id === activePointId
            });
    },

    activeItem: function activeItem () {
        const activePoint = this.activePoint();
        if (typeof activePoint === 'undefined') {
            return undefined;
        }
        const collections = {
            phase: this.props.phases,
            update: this.props.updates
        };

        return collections[activePoint.itemType].find(elem => {
            return elem.id === activePoint.itemId
        });
    },

    currentPhaseItem: function () {
        const { currentPhase } = this.props.timeLine;
        return this.props.phases.find(phase => {
            return phase.id === currentPhase
        });
    },

    detailsPane: function detailsPane () {
        const activePoint = this.activePoint();
        if (typeof activePoint !== 'undefined') {
            return &lt;DetailsPane actions={this.props.actions}
                                item={this.activeItem()}
                                point={activePoint} />;
        }
    },

    render: function render() {
        const { phases, timeLine, actions, updates, points } = this.props;
        const { phaseCount } = timeLine;

        const activePoint = this.activePoint();
        if (typeof activePoint !== 'undefined') {

        }
        const detailsPane = this.detailsPane();
        const currentPhaseItem = this.currentPhaseItem();

        return (
            &lt;div className="time-line-component" style={this.style}>
                &lt;h2>Volg de wet&lt;/h2>
                &lt;TimeLinePhases
                    timeLine={timeLine}
                    actions={actions}
                    points={points}
                    updates={updates}
                    phases={phases} />
                &lt;TimeLine phaseCount={phaseCount}
                          currentPhaseIndex={currentPhaseItem.index} />
                {detailsPane}
            &lt;/div>
        );
    }
});
window.TimeLineComponent = TimeLineComponent;

/**
 * The display block for phases and their accompanying updates in order.
 * @todo Rework so it only uses {@link Point}s
 * @class TimeLine
 * @author Fletcher91 &lt;thom@argu.co>
 */
export const TimeLinePhases = React.createClass({
    style: {
        display: 'flex',
        flexDirection: 'row'
    },

    pointActive: function (point, activePointId) {
        return point.id === activePointId ? 'active' : undefined;
    },

    pointByItem: function pointByItem(itemType, itemId) {
        return this.props.points.find(point => {
                return point.itemType === itemType &amp;&amp;
                    point.itemId === itemId;
            });
    },

    pointsForPhase: function pointsForPhase(phaseId) {
        const { updates, timeLine, actions } = this.props;
        const { activePointId } = timeLine;

        if (typeof updates === 'undefined') {
            return undefined;
        }

        return updates
            .filter((update) => {
                return update.phaseId === phaseId;
            })
            .map((update) => {
                const point = this.pointByItem('update', update.id);
                return &lt;Point key={point.id}
                              point={point}
                              active={this.pointActive(point, activePointId)}
                              actions={actions} />;
            });
    },

    render: function render() {
        const { actions, phases, timeLine } = this.props;
        const { id, activePointId, currentPhase } = timeLine;

        const phasesList = phases.map((phase, i) => {
            const itemUpdates = this.pointsForPhase(phase.id);
            const current = phase.id === currentPhase ? 'current' : '';
            const last  = i === phases.length - 1;
            const point = this.pointByItem('phase', phase.id);
            return (&lt;Phase key={phase.id}
                           phase={new RPhase(phase)}
                           point={point}
                           active={this.pointActive(point, activePointId)}
                           current={current}
                           last={last}
                           timelineId={id}
                           actions={actions}>
                {itemUpdates}
            &lt;/Phase>);
        });

        return (
            &lt;div className="time-line-phases" style={this.style}>
                {phasesList}
            &lt;/div>
        );
    }
});
window.TimeLinePhases = TimeLinePhases;

/**
 * The actual line of the timeline.
 * @todo Rework so it only uses {@link Point}s
 * @class TimeLine
 * @author Fletcher91 &lt;thom@argu.co>
 */
export const TimeLine = React.createClass({
    propTypes: {
        phaseCount: React.PropTypes.number,
        currentPhaseIndex: React.PropTypes.number
    },

    completionWidth: function completionWidth() {
        const phasePercentage = 100 / (this.props.phaseCount - 1);
        const width = (this.props.currentPhaseIndex * phasePercentage) + (phasePercentage / 2);
        return `${width}%`;
    },

    style: {
        width: '100%',
        height: 1,
        border: 0,
        borderTop: '3px solid #CCC',
        padding: 0,
        marginTop: '-.6em',
        zIndex: 1,
        marginBottom: '.6em'
    },

    render: function render() {
        const innerStyle = Object.assign({},
            this.style,
            {
                width: this.completionWidth(),
                borderTop: '3px solid #8BAACA',
                marginTop: '-.2em',
                zIndex: 2
            }
        );

        return (
            &lt;div className="time-line" style={this.style}>
                &lt;div className="inner-line" style={innerStyle}>&lt;/div>
            &lt;/div>
        );
    }
});
window.TimeLinePhases = TimeLinePhases;

/**
 * That thing beneath a {@link TimeLine} when you click on a {@link Point}.
 * @class DetailsPane
 * @author Fletcher91 &lt;thom@argu.co>
 */
export const DetailsPane = React.createClass({
    propTypes: {
        actions: React.PropTypes.object,
        item: React.PropTypes.object,
        point: React.PropTypes.object
    },

    style: {
        display: 'flex',
        alignItems: 'center'
    },

    nextItem: function () {
        let { timelineId } = this.props.point;
        this.props.actions.nextPoint(timelineId);
    },

    previousItem: function () {
        let { timelineId } = this.props.point;
        this.props.actions.previousPoint(timelineId);
    },

    render: function render() {
        const { item, point } = this.props;

        if (typeof item === 'undefined') {
            return &lt;div>&lt;/div>;
        }

        const UpdateItem = point.itemType === 'update' ?
            &lt;UpdateContainerWrapper updateId={item.id}
                                    {...item} /> :
            &lt;Update update={new RUpdate()}
                    {...item} />;

        return (&lt;div className="details-pane" style={this.style}>
            &lt;span className="details-pane-previous"
                  style={{fontSize: '2em'}}
                  onClick={this.previousItem}>&amp;lt;&lt;/span>
            {UpdateItem}
            &lt;span className="details-pane-next"
                  style={{fontSize: '2em'}}
                  onClick={this.nextItem}>&amp;gt;&lt;/span>
        &lt;/div>);
    }
});
window.DetailsPane = DetailsPane;

/**
 * Represents a Phase within a {@link TimeLine}
 * Also renders all its children updates as {@link Point}s.
 * @class Phase
 * @author Fletcher91 &lt;thom@argu.co>
 */
export const Phase = React.createClass({
    propTypes: {
        phase: React.PropTypes.instanceOf(RPhase),
        point: React.PropTypes.object,
        actions: React.PropTypes.object,
        last: React.PropTypes.bool
    },

    style: {
        display: 'flex',
        flexDirection: 'row'
    },

    getLabel: function () {
        const { last, phase } = this.props;
        const { title } = phase;

        if (!last) {
            return &lt;span className="phase-title" style={{textAlign: 'center'}}>{title}&lt;/span>
        } else {
            return &lt;span style={{flex: 1}}>&lt;/span>;
        }
    },

    render: function render() {
        const { actions, point, current, last, active } = this.props;

        const label = this.getLabel();
        const style = {
            display: 'flex',
            flexDirection: 'column',
            flexGrow: last ? 0 : 1,
            zIndex: 10
        };
        return (
            &lt;div className={`phase ${current}`} style={style}>
                {label}
                &lt;div className="phase-points" style={this.style}>
                    &lt;PhasePoint point={point}
                                active={active}
                                actions={actions}
                                current={current} />
                    {this.props.children}
                &lt;/div>
            &lt;/div>
        );
    }
});
window.Phase = Phase;

/**
 * Represents a Point on a {@link TimeLine}.
 * @class Point
 * @author Fletcher91 &lt;thom@argu.co>
 */
export const Point = React.createClass({
    propTypes: {
        point: React.PropTypes.object,
        actions: React.PropTypes.object
    },

    setActive: function setActive() {
        const { active } = this.props;
        let { id, timelineId } = this.props.point;
        if (active) {
            id = 0;
        }
        this.props.actions.setActivePoint(timelineId, id);
    },

    render: function render() {
        const { active } = this.props;

        const style = {
            flexGrow: 1,
            border: active ?  '1px solid yellow' : undefined
        };

        return (&lt;span className={`point ${this.props.active}`}
                      onClick={this.setActive}
                      style={style}>U&lt;/span>);
    }
});
window.Point = Point;

/**
 * To display a Phase point on a {@link TimeLine}
 * @class PhasePoint
 * @author Fletcher91 &lt;thom@argu.co>
 */
export const PhasePoint = React.createClass({
    propTypes: {
        title: React.PropTypes.string,
        point: React.PropTypes.object
    },

    setActive: function makeActive() {
        const { active } = this.props;
        let { id, timelineId } = this.props.point;
        if (active) {
            id = 0;
        }
        this.props.actions.setActivePoint(timelineId, id);
    },

    render: function render() {
        const { current, active } = this.props;

        const style = {
            flexGrow: 1,
            border: active ?  '1px solid yellow' : undefined
        };

        return (
            &lt;span className={`point phase-point ${current} ${active}`}
                  onClick={this.setActive}
                  style={style}>P&lt;/span>
        );
    }
});
window.PhasePoint = PhasePoint;

export default TimeLineComponentContainer;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-BigVote.html">BigVote</a></li><li><a href="module-CombiBigVote.html">CombiBigVote</a></li><li><a href="module-FollowTheLaw.html">FollowTheLaw</a></li><li><a href="module-Helpers.html">Helpers</a></li><li><a href="module-Update.html">Update</a></li></ul><h3>Classes</h3><ul><li><a href="BigVote.BigVoteButtons.html">BigVoteButtons</a></li><li><a href="BigVote.BigVoteResults.html">BigVoteResults</a></li><li><a href="module-FollowTheLaw-DetailsPane.html">DetailsPane</a></li><li><a href="module-FollowTheLaw-Phase.html">Phase</a></li><li><a href="module-FollowTheLaw-PhasePoint.html">PhasePoint</a></li><li><a href="module-FollowTheLaw-Point.html">Point</a></li><li><a href="module-FollowTheLaw-TimeLine.html">TimeLine</a></li><li><a href="module-FollowTheLaw-TimeLineComponent.html">TimeLineComponent</a></li><li><a href="module-FollowTheLaw-TimeLineComponentContainer.html">TimeLineComponentContainer</a></li><li><a href="module-FollowTheLaw-TimeLineComponentContainerWrapper.html">TimeLineComponentContainerWrapper</a></li><li><a href="Profile.html">Profile</a></li><li><a href="RDateline.html">RDateline</a></li><li><a href="RImage.html">RImage</a></li><li><a href="RPhase.html">RPhase</a></li><li><a href="RPoint.html">RPoint</a></li><li><a href="RProfile.html">RProfile</a></li><li><a href="RTimeline.html">RTimeline</a></li><li><a href="RUpdate.html">RUpdate</a></li></ul><h3>Global</h3><ul><li><a href="global.html#initialState">initialState</a></li><li><a href="global.html#nextPoint">nextPoint</a></li><li><a href="global.html#previousPoint">previousPoint</a></li><li><a href="global.html#SET_ACTIVE_POINT">SET_ACTIVE_POINT</a></li><li><a href="global.html#setActivePoint">setActivePoint</a></li><li><a href="global.html#setCurrentPhase">setCurrentPhase</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Mon Dec 14 2015 15:06:35 GMT+0100 (CET)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
