<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: reducers/timelines.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: reducers/timelines.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { Map, OrderedSet } from 'immutable';
import {
    NEXT_POINT,
    PREVIOUS_POINT,
    SET_ACTIVE_TIMELINE
} from '../constants/ActionTypes';

/**
 * Timelines state tree structure definition
 * @param {number} activeTimelineId The id of the currently active {@link RTimeline}.
 * @param {RTimeline} activeTimeline A reference to the object instance in the collection with activeTimelineId
 * @param {Map} collection All the points currently in the system.
 * @param {OrderedSet.&lt;number>} order The point ids in order.
 */
const initialState = new Map({
    activeTimelineId: undefined,
    activeTimeline: undefined,
    collection: new Map({}),
    order: new OrderedSet()
});

function replaceTimeline(state, timeline) {
    return state.setIn(
        ['collection', timeline.id.toString()],
        timeline
    );
}

/**
 * @private
 * Creates a new timeline with {@param newMembers} values replaced.
 * @param timeline
 * @param newMembers
 */
function updateTimeline(timeline, newMembers) {
    return timeline.merge(
        timeline,
        newMembers
    );
}

/**
 * @private
 * Returns a timeline from the state for an action or an id.
 * @param idOrAction The action object or the timeline id.
 * @returns {RTimeline}
 */
function getTimeline(state, idOrAction) {
    return state.getIn([
        'collection',
        tId(idOrAction).toString()
    ]);
}

/**
 * @private
 * Returns the id of the timeline an action is meant for.
 * Also returns the instance if it's not an object for shorthand usage.
 * @param action The action object or the id
 * @returns {number} The id of the timeline.
 */
function tId(idOrAction) {
    return parseInt(
        typeof idOrAction === 'object'
            ? (idOrAction.timelineId || 0)
            : idOrAction);
}

/**
 * Composite function to update attributes on an action defined timeline.
 * @param newMembers {object} A key value object for the new member values.
 */
function updateTimelineInState(state, action, newMembers) {
    const currentTimeline = getTimeline(state, action);
    return replaceTimeline(
        state,
        updateTimeline(
            currentTimeline,
            newMembers
        ));
}

/**
 * Timelines reducer
 * @author Fletcher91 &lt;thom@argu.co>
 */
export default function timelines(state = initialState, action) {
    const currentTimeline = getTimeline(state, action);
    switch (action.type) {
        case SET_ACTIVE_TIMELINE:
            return state.withMutations((mutState) => {
                mutState.set('activeTimelineId', action.timelineId);
                mutState.set('activeTimeline',
                    state
                        .get('collection')
                        .find(t => {
                            return t.id === action.timelineId;
                    }))
            });
        case NEXT_POINT:
            return updateTimelineInState(
                state,
                action,
                {activePointId: currentTimeline.activePointId + 1}
            );
        case PREVIOUS_POINT:
            return updateTimelineInState(
                state,
                action,
                {activePointId: currentTimeline.activePointId - 1}
            );
        default:
            return state;
    }
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-BigVote.html">BigVote</a></li><li><a href="module-CombiBigVote.html">CombiBigVote</a></li><li><a href="module-FollowTheLaw.html">FollowTheLaw</a></li><li><a href="module-Helpers.html">Helpers</a></li><li><a href="module-Update.html">Update</a></li></ul><h3>Classes</h3><ul><li><a href="BigVote.BigVoteButtons.html">BigVoteButtons</a></li><li><a href="BigVote.BigVoteResults.html">BigVoteResults</a></li><li><a href="DetailsPane.html">DetailsPane</a></li><li><a href="Link.html">Link</a></li><li><a href="module-FollowTheLaw-Phase.html">Phase</a></li><li><a href="module-FollowTheLaw-PhasePoint.html">PhasePoint</a></li><li><a href="module-FollowTheLaw-TimeLine.html">TimeLine</a></li><li><a href="module-FollowTheLaw-TimeLineComponent.html">TimeLineComponent</a></li><li><a href="module-FollowTheLaw-TimeLineComponentContainer.html">TimeLineComponentContainer</a></li><li><a href="module-FollowTheLaw-TimeLineComponentContainerWrapper.html">TimeLineComponentContainerWrapper</a></li><li><a href="Point.html">Point</a></li><li><a href="Profile.html">Profile</a></li><li><a href="RDateline.html">RDateline</a></li><li><a href="RImage.html">RImage</a></li><li><a href="RPhase.html">RPhase</a></li><li><a href="RPoint.html">RPoint</a></li><li><a href="RProfile.html">RProfile</a></li><li><a href="RTimeline.html">RTimeline</a></li><li><a href="RUpdate.html">RUpdate</a></li></ul><h3>Global</h3><ul><li><a href="global.html#activeItem">activeItem</a></li><li><a href="global.html#activePoint">activePoint</a></li><li><a href="global.html#initialState">initialState</a></li><li><a href="global.html#nextPoint">nextPoint</a></li><li><a href="global.html#previousPoint">previousPoint</a></li><li><a href="global.html#replaceDateStrings">replaceDateStrings</a></li><li><a href="global.html#reviver">reviver</a></li><li><a href="global.html#SET_ACTIVE_TIMELINE">SET_ACTIVE_TIMELINE</a></li><li><a href="global.html#setActivePoint">setActivePoint</a></li><li><a href="global.html#setActiveTimeline">setActiveTimeline</a></li><li><a href="global.html#setCurrentPhase">setCurrentPhase</a></li><li><a href="global.html#updateTimelineInState">updateTimelineInState</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Mon Dec 28 2015 13:15:52 GMT+0100 (CET)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
