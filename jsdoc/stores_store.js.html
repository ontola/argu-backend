<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: stores/store.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: stores/store.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import configureStore from '../stores/configureStore';
import Immutable from 'immutable';
import {
    RDateline,
    RPhase,
    RPoint,
    RProfile,
    RTimeline,
    RUpdate
} from '../records/index';
import popstate from '../actions/popstate';

const types = {
    dateline: RDateline,
    phase: RPhase,
    point: RPoint,
    profile: RProfile,
    timeline: RTimeline,
    update: RUpdate
};

/**
 * Replaces all the fields' values where the key matches /(D|d)ate/ with a Date object.
 * @param object An Immutable-type object.
 * @returns {Immutable/Iterable}
 */
function replaceDateStrings(object) {
    return object
        .map((i, k, o) => {
            return k
                .toString()
                .match(/(D|d)ate/)
                    ? new Date(o.get(k))
                    : o.get(k)
        });
}

/**
 * [Reviver function]{@link https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse#Using_the_reviver_parameter}
 * to regenerate Immutable objects for the stores.
 * @param key
 * @param value
 * @returns {Immutable/Iterable}
 */
function reviver (key, value) {
    const isIndexed = Immutable.Iterable.isIndexed(value);
    if (isIndexed) {
        return replaceDateStrings(value).toList();
    } else if (value.get('type') &amp;&amp;
               types.hasOwnProperty(value.get('type'))) {
        const datedObject = replaceDateStrings(value);
        const record = new types[value.get('type')](datedObject);
        return record;
    } else {
        return replaceDateStrings(value).toMap();
    }
}

function generateInitialState (state = window.__INITIAL_STATE__) {
    var immutableInitialState = {};
    Object
        .keys(state || {})
        .forEach((value) => {
            immutableInitialState[value] = Immutable.fromJS(state[value], reviver);
        });
    return immutableInitialState;
}

const store = configureStore(generateInitialState());

if (window) {
    window.onpopstate = function(event) {
        if (typeof event.state.timelines !== undefined) {
            store.dispatch(popstate(generateInitialState(event.state)));
        }
    };
}

export default store;

export function liveStore () {
    return configureStore(generateInitialState());
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-BigVote.html">BigVote</a></li><li><a href="module-CombiBigVote.html">CombiBigVote</a></li><li><a href="module-FollowTheLaw.html">FollowTheLaw</a></li><li><a href="module-Helpers.html">Helpers</a></li><li><a href="module-Update.html">Update</a></li></ul><h3>Classes</h3><ul><li><a href="BigVote.BigVoteButtons.html">BigVoteButtons</a></li><li><a href="BigVote.BigVoteResults.html">BigVoteResults</a></li><li><a href="DetailsPane.html">DetailsPane</a></li><li><a href="DetailsPaneContainerComponent.html">DetailsPaneContainerComponent</a></li><li><a href="Link.html">Link</a></li><li><a href="module-FollowTheLaw-Phase.html">Phase</a></li><li><a href="module-FollowTheLaw-TimeLine.html">TimeLine</a></li><li><a href="module-FollowTheLaw-TimeLineComponent.html">TimeLineComponent</a></li><li><a href="module-FollowTheLaw-TimeLineComponentContainer.html">TimeLineComponentContainer</a></li><li><a href="module-FollowTheLaw-TimeLineComponentContainerWrapper.html">TimeLineComponentContainerWrapper</a></li><li><a href="Point.html">Point</a></li><li><a href="Profile.html">Profile</a></li><li><a href="RDateline.html">RDateline</a></li><li><a href="RImage.html">RImage</a></li><li><a href="RPhase.html">RPhase</a></li><li><a href="RPoint.html">RPoint</a></li><li><a href="RProfile.html">RProfile</a></li><li><a href="RTimeline.html">RTimeline</a></li><li><a href="RUpdate.html">RUpdate</a></li></ul><h3>Global</h3><ul><li><a href="global.html#activeItem">activeItem</a></li><li><a href="global.html#activePoint">activePoint</a></li><li><a href="global.html#getMarker">getMarker</a></li><li><a href="global.html#initialState">initialState</a></li><li><a href="global.html#nextPoint">nextPoint</a></li><li><a href="global.html#previousPoint">previousPoint</a></li><li><a href="global.html#replaceDateStrings">replaceDateStrings</a></li><li><a href="global.html#reviver">reviver</a></li><li><a href="global.html#SET_ACTIVE_TIMELINE">SET_ACTIVE_TIMELINE</a></li><li><a href="global.html#setActivePoint">setActivePoint</a></li><li><a href="global.html#setActiveTimeline">setActiveTimeline</a></li><li><a href="global.html#setCurrentPhase">setCurrentPhase</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Sat Jan 16 2016 15:26:46 GMT+0100 (CET)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
