(function() {
    /*if (!document.getElementById('argu-acss'))
    {
        var link  = document.createElement('link');
        link.id   = 'argu-acss';
        link.rel  = 'stylesheet';
        link.type = 'text/css';
        link.href = '//<%= Rails.application.config.host + asset_path('widgets/argu.css') %>';
        link.media = 'all';
        document.getElementsByTagName('head')[0].appendChild(link);
    } */
    var Motion = function () {
        var motions = document.getElementsByTagName("motion");
        console.log('arguments found: ' + motions.length);

        for(var i = 0; i < motions.length; i++) {
            var motion = motions[i];
            if (motion.id == null) break;

            var req = new XMLHttpRequest();
            req.onload = function (e) {
                if (e.target.readyState == 4 && e.target.status == 200) {
                    motion.innerHTML = e.target.responseText;
                }
            };
            req.open("get", "//<%= Rails.application.config.host %>/m/" + motion.id + '.widget', true);
            req.send();
        }
    };

    var Argument = function () {
        var arguments = document.getElementsByTagName("argument");
        console.log('arguments found: ' + arguments.length);

        for(var i = 0; i < arguments.length; i++) {
            var argument = arguments[i];
            if (argument.id == null) break;

            var req = new XMLHttpRequest();
            req.onload = function (e) {
                if (e.target.readyState == 4 && e.target.status == 200) {
                    argument.innerHTML = e.target.responseText;
                }
            };
            req.open("get", "//<%= Rails.application.config.host %>/a/" + argument.id + '.widget', true);
            req.send();
        }
    };


    var run = function () {
        Argument();
        Motion();
    };
    document.addEventListener("DOMContentLoaded", run);
    console.log('argu sdk loaded');
})();